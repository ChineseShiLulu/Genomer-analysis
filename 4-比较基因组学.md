# 比较基因组学
- [比较基因组学分析](#比较基因组学分析)
- [基本概念](#基本概念)
  - [Orthologs-直系同源物](#Orthologs-直系同源物)
  - [基因家族](#基因家族)
  - [共线性](#共线性)
- [分析内容](#分析内容)
  - [基因家族聚类](#基因家族聚类)
  - [系统进化分析](#系统进化分析)
  - [分化时间分析](#分化时间分析)
  - [基因家族扩张收缩](#基因家族扩张收缩)
  - [选择压力分析](#选择压力分析)
  - [基因组共线性分析](#基因组共线性分析)
  - [全基因组复制事件](#全基因组复制事件)
- [分析软件](#分析软件)
  - [共线性比对](#共线性比对)
  - [正选择基因的计算](#正选择基因的计算)
  - [保守原件分析](#保守原件分析)

## 比较基因组学分析
* 比较基因组学分析通过比较多物种蛋白序列或者基因位置与相对顺序，包括基因的丢失、复制、水平转移等。鉴定物种之间保守的基因（找物种相似之处），或者某个生物自身特有的基因（找物种不同之处），旨在阐释物种多样性的分子遗传基础。
一般流程：![image](https://user-images.githubusercontent.com/111029483/222677858-b81d1e41-52bf-43f5-a69a-ad0f1061f9ae.png)

## 基本概念
### Orthologs-直系同源物
* 是在两个物种的最后共同祖先（`LCA`）中来自单个基因的一对基因。直系同源物是同源性基因，是物种形成事件的结果。`Paralogs`（旁系同源物)是同源基因，是重复事件的结果。下图就可以看到，不同物种间的`alpha-chain gene`互为`Orthologs`(直系同源物)。这时候可以引用一个新名词`orthogroup` （正交群）就用来形容自一组物种的LCA中的单个基因的基因组（在图中就是alpha chain gene）。然后同一物种间`alpha` 和`beta chain gene`互为`Paralogs`(旁系同源物)。最后所有这些关系都可以由OrthoFinder来识别。![image](https://user-images.githubusercontent.com/111029483/222678016-af98a821-eafd-4034-89cb-2f42dbf48e4e.png)

### 基因家族
* 是来源于同一个祖先，由一个基因通过基因重复而产生两个或更多的拷贝而构成的一组基因，它们在结构和功能上具有明显的相似性，编码相似的蛋白质产物，同一家族基因可以紧密排列在一起，形成一个基因簇，但多数时候，它们是分散在同一染色体的不同位置，或者存在于不同的染色体上的，各自具有不同的表达调控模式。在基因组项目中，通常会选择自己要研究的物种和其近缘的物种通过比对来寻找基因家族。
### 共线性
* 所谓的共线性主要是用来描述同一染色体上基因的位置关系，也就是指由同一祖先型分化而来的不同物种间基因的类型以及相对顺序的保守性（即基因的同源性+基因的排列顺序）。
* 共线性片段的大小与物种之间的分化时间有很大关系：分化时间较短的物种间，积累的变异较少，会保留更多从祖先遗传下来的特征；相反的，分化时间较长的物种间由于变异积累而导致共有的特征变少，反而获得较短的共线性片段。
* 基因同源又可以分为直系同源和旁系同源。直系同源基因指存在于祖先基因组中，随后因为物种分化，分别遗传给不同的后代，这些基因在结构和功能上有很高的相似性。旁系同源基因指同一基因组中由于基因复制而产生的的同源基因，这些基因往往变异较大，从而可能出现功能变异。
* 共线性分析是比较基因组中必不可少的分析策略，因为它允许分析物种间大尺度和小尺度的分子进化事件。大尺度进化事件主要包括对基因组内重排和复制事件的估计，例如，可以使用人与小鼠之间的全基因组比对来识别共线性同源区块，然后确定重排事件，从而解释两个基因组结构差异。小尺度进化事件则是针对基因组水平的碱基替换速率以及插入、缺失事件。从共线性片段中可以识别出的物种间小尺度和大尺度突变事件，这些都可以作为物种树推断数据。此外，结合构建的两个尺度的基因组进化模型，共线性比对还能够完成祖先基因组重建的任务。
* 由于基因组共线性通常可以预测同源序列，并且同源序列可能具有相似的功能，因此全基因组共线性分析对于功能预测是十分有价值的。可以通过在整个基因组的核苷酸水平上对齐，从而可以帮助预测编码和非编码区域的功能。 例如，如果我们对人类基因组中特定的疾病相关区域感兴趣，我们可能会使用对齐来识别其小鼠同源基因的位置。 通过对小鼠同源片段的了解将使我们能够更好地了解这个基因组区域的进化历史，并可能进行遗传操作实验。

共线性比较需有物种的染色体水平的参考基因组。

进化树外群的选取基于三个原则：
```
①外群物种要比研究物种先从祖先物种中分化出去；
②外群物种与研究物种的亲缘关系不宜太远；
③基因组组装质量较好。目前，外群物种的选取可以从文献调研、分类系统查找、项目经验等三种途径进行获取。寻找已发表基因组的近源物种文章。文章正文或附录中的系统进化树，最外面的物种即为外群物种。
```
## 分析内容：
### 基因家族聚类
### 系统进化分析
* 通过与其它种基因组进行比较，挖掘目的物种与不同种间的系统进化关系。利用单拷贝蛋白序列建进化树，通过外群的加入，使无根树转为有根树。
### 分化时间分析
* 通过与其它种基因组进行比较，挖掘不同种间的系统进化关系。根据各类生物间的亲缘关系的远近，把各类生物安置在有分枝的树状的图表上，简明地表示生物的进化历程和亲缘关系。借助于化石时间矫正,可以得到有分化时间的物种树,从而获得物种之间的亲缘关系和分歧时间，有利于阐明物种的进化历史。
### 基因家族扩张收缩
* 在比较基因组学中往往要研究具有某一类功能或者控制某性状的基因家族在所研究的物种上是变多了还是变少。这就需要对基因家族进行收缩与扩张分析。通过目标物种和近源物种之间的进化关系，模拟推算共同祖先的状态，然后两者都和祖先比较，进而确定收缩和扩张的基因家族使用带有分歧时间的进化树和基因家族聚类之后的结果，通过出生死亡率模型估计每个分枝的祖先的基因家族成员个数，从而预测出该物种基因家族相对于祖先的收缩和扩张情况。
### 选择压力分析
* 选择压力是指外界施加给某物种生物进化过程中的压力，使得物种适应自然环境。在遗传学中，`Ka/Ks`或者dN/dS表示的是异义替换（Ka）和同义替换（Ks）之间的比例。一般认为，同义突变不受自然选择，而非同义突变则受到自然选择作用。如果`Ka/Ks>1`，则认为有正选择效应。如果Ka /Ks=1，则认为存在中性选择。如果Ka/Ks<1，则认为有纯化选择作用。
### 基因组共线性分析
* 线性暗示两个物种来源与共同的祖先序列，有着相似的功能。通过对物种内或者物种间共线性相关联，来确定物种内部或者物种间的结构变异，揭示物种染色体进化，研究物种内部多倍化等事件。主要应用：结构变异的挖掘、基因组组装准确性验证（与已发表比较验证）、观察全基因组复制事件、功能基因组学研究（有相同生物学功能）。
### 全基因组复制事件
* 多倍化（polyploidy）或全基因组加倍（whole genome duplication, WGD）事件使基因组内的所有基因都发生重复，为生物进化提供了原始的遗传材料，被认为是进化的加速器。全基因组复制事件在真菌或动植物中都有发生，是基因组中基因数量变化、基因新功能的形成、基因重排等的重要推动力。
* 由于在同一基因组上共线性的染色体片段中有旁系同源的基因集，因此可以通过这些成对的共线性片段追溯目的物种曾经的复制事件。通过研究全基因组复制事件，可以确定物种发生全基因组倍增时间，同时也通过分化时间的比对来判断复制是发生在分化之前还是分化之后。常用方式：KS/4DTV
  * KS：全基因组加倍事件会产生大量的同源基因，反映在Ks值上便是会有大量的Ks值接近的同源基因对的产生，Ks值峰就对应了全基因组加倍事件的存在。
  * 4DTV：如果密码子的第三个位点无论是哪种核苷酸，均编码同样的氨基酸，则称这个位点为4倍简并位点。较多的基因对数存在4倍简并位点，说明基因组多样性较多（or冗余基因较多），可能此刻发生了物种分化或者基因组复制。
 
## 分析软件
### 共线性比对
`LAST`软件
1. 建立参考基因组索引：
```
lastdb -uNEAR -cR11 nc_db goat.fa
```
2. 将使用的动物基因组比对到所用的参考基因组

使用的是测序后高质量的基因组.fa文件
```
lastal -P48 -m100 -E0.05 nc_db ruminant.species.fa |last-split -m1 > ruminant.species.maf
```
`last-split `命令对所得到的比对文件进行过滤保留一对一的比对区域

后经过 `last-sort`命令将比对文件按照染色体顺序进行排序。

3. 将每个两两比对的结果 maf 文件利用 `multiz` 程序采用参数`“-0 a –all” `基于参考基因组共线性关系合并成为多序列比对文件。

得到以所用参考基因组为参考基因组 的物种的全基因组共线性比对结果文件
### 正选择基因的计算
1. 利用基因组共线性结果，基于注释状况很好的基因组注释文件提取并建立高度可信的直系同源因集合。

2. 为了得到准确的正选择基因结果，对直系同源基因集合进行进一步的过滤。
```
    主要是为了排除基因组基因注释，序列组装，假基因，非同源比对等错误对正选择基因计算的干扰。
    这里设定了严格的过滤条件：第一，为了确保是直系同源基因，每个基因保证至少 80% 的编码序列须单一的同源比对到参考基因组上；
                             第二，过滤具有移码突变的基因；
                             第三，过滤具有提前终止密码子的基因。第四，过滤基因同义突变率（Ks）不大于 2； 最后过滤比对的编码区序列长度小于 150bp 的基因。
```
3. `PAML`软件采用分支位点模型的方法计算动物的正选择基因
    最大似然检验（`LRT`）用来检验正选择氨基酸位点。通过卡方检验方法计算显著性 P 值
    
### 保守原件分析
共线性基因组多重比对结果

利用 `PHAST` 软件包中的 `phastCons` 程序进行动物保守元件的计算

    在计算保守元件前需要估计中性系统发育模型。`四倍简并位点`在进化过程中认为是不受到选择的中性进化

1. 利用 `PHAST` 软件包中的 `phyloFit` 程序提取动物的基因组中的四倍简并位点
     利用四倍简并位点进行中性进化模型的估计。
```
   msa_view提取四倍简并位点
msa_view 67species.maf --features goat.gff --4d --out-format FASTA > 4DTV.fasta

   phyloFit估计中性进化模型
phyloFit --tree tree.nwk --msa-format FASTA --out-root nonconserved-4d.mod
```
2. 使用 `phastCons` 和 `phyloBoot` 进行保守模型的评估，需要第二步的中性模型作为输入
```
A、msa_split chr.maf --in-format MAF --windows 100000,0 --out-root split_maf/chr --out-format SS --min-informative 1000 --between-blocks 5000
B、phastCons --estimate-rho window.ss --no-post-probs window.ss nonconserved-4d.mod.mod 
C、phyloBoot --read-mods window.cons.list --output-average Average.chr.cons.mod
```
3. 结合保守模型和中性进化模型，利用 `phastCons` 程序计算动物的保守元件。
      此外，过滤掉长度小于 20bp 的保守元件

4. 为了获得动物中特异保守的元件，利用 `BLAST` 程序将得到的动物保守元件比对到外群物种基因组序列上。 
```
-task blastn, -outfmt 7, -max_target_seqs 1, -max_hsps 1
```
如果比对的 `E-value < 1e-5` 且 `identity ≥ 90%` 被认为能够比对到外群物种。能够比对到外群物种中任意一个物种的元件，认为其不是该动物特异的，将被过滤掉。最后，可得到该动物特异的缺少明显直系同源外群的保守元件。






































